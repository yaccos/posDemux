<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Suggested setup for FASTQ streaming — streaming_callbacks • posDemux</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Suggested setup for FASTQ streaming — streaming_callbacks"><meta name="description" content="Even though the user can define the arguments state_init,
loader, and archiver
for streaming_demultiplex(), this approach is only recommended
for advanced users. This functions defines a premade combinations of
these three arguments which should be suitable in most cases.
The loader streams a FASTQ file (having multiple files is also supported)
and the archiver outputs
a data frame to file consisting of the read name (read),
the sequences of all payloads (e.g. UMI), and barcode assignments
(c('bc3','bc2','bc1'))."><meta property="og:description" content="Even though the user can define the arguments state_init,
loader, and archiver
for streaming_demultiplex(), this approach is only recommended
for advanced users. This functions defines a premade combinations of
these three arguments which should be suitable in most cases.
The loader streams a FASTQ file (having multiple files is also supported)
and the archiver outputs
a data frame to file consisting of the read name (read),
the sequences of all payloads (e.g. UMI), and barcode assignments
(c('bc3','bc2','bc1'))."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">posDemux</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/posDemux.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/streaming.html">Streaming data into the demultiplexer</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yaccos/posDemux/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Suggested setup for FASTQ streaming</h1>
      <small class="dont-index">Source: <a href="https://github.com/yaccos/posDemux/blob/main/R/streaming_callbacks.R" class="external-link"><code>R/streaming_callbacks.R</code></a></small>
      <div class="d-none name"><code>streaming_callbacks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Even though the user can define the arguments <code>state_init</code>,
<code>loader</code>, and <code>archiver</code>
for <code><a href="streaming_demultiplex.html">streaming_demultiplex()</a></code>, this approach is only recommended
for advanced users. This functions defines a premade combinations of
these three arguments which should be suitable in most cases.
The loader streams a FASTQ file (having multiple files is also supported)
and the archiver outputs
a data frame to file consisting of the read name (<code>read</code>),
the sequences of all payloads (e.g. <code>UMI</code>), and barcode assignments
(<code>c('bc3','bc2','bc1')</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">streaming_callbacks</span><span class="op">(</span></span>
<span>  <span class="va">input_file</span>,</span>
<span>  <span class="va">output_table_file</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1e+06</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_width <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-file">input_file<a class="anchor" aria-label="anchor" href="#arg-input-file"></a></dt>
<dd><p>A character vector containing the paths to the FASTQ files
to be used for demultiplexing. Often this is only one file, but multiple
files are supported such that demultiplexing data from multiple lanes does
not require merging the lanes first.</p></dd>


<dt id="arg-output-table-file">output_table_file<a class="anchor" aria-label="anchor" href="#arg-output-table-file"></a></dt>
<dd><p>The path to which the output
barcode table will be written.</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Integer, the number of reads to process in each chunk.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical scalar: Should the progress be displayed?</p></dd>


<dt id="arg-min-width">min_width<a class="anchor" aria-label="anchor" href="#arg-min-width"></a></dt>
<dd><p>Optional integer scalar:
Minimum width of the sequences to keep.
For reads which are shorter than this, a warning is emitted and the
reads are removed and ignored and thus not appear in any statistics.
The data loader is <strong>not</strong> supposed to be used as a length filter,
so this option
is more like an escape hatch for being able to deal
with sequences which have not been
properly filtered beforehand.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with the following elements, all of which are intended to be
used as the corresponding arguments to <code><a href="streaming_demultiplex.html">streaming_demultiplex()</a></code>:</p><ul><li><p><code>state_init</code></p></li>
<li><p><code>loader</code></p></li>
<li><p><code>archiver</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If the read names have any spaces in them,
the loader will only keep the portion of
the read name preceding the first space. This is due to the Illumina
platform's behavior of encoding the sequencing direction (forward or reverse)
past the space.
Keeping the read names with the space is usually not desirable as it makes
the resulting barcode table more confusing and makes it more difficult to
group the forward and reverse reads together afterwards.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/ShortRead/man/Sampler-class.html" class="external-link">ShortRead::FastqStreamer()</a></code> which is used
as a backend for the data loader.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings" class="external-link">Biostrings</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input_fastq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"extdata"</span>, <span class="st">"PETRI-seq_forward_reads.fq.gz"</span>, package <span class="op">=</span> <span class="st">"posDemux"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">output_barcode_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"barcode_table"</span>, fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">callbacks</span> <span class="op">&lt;-</span> <span class="fu">streaming_callbacks</span><span class="op">(</span></span></span>
<span class="r-in"><span>    input_file <span class="op">=</span> <span class="va">input_fastq</span>, output_table_file <span class="op">=</span> <span class="va">output_barcode_table</span>,</span></span>
<span class="r-in"><span>    chunk_size <span class="op">=</span> <span class="fl">10000</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcode_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"extdata/PETRI-seq_barcodes"</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>bc1 <span class="op">=</span> <span class="st">"bc1.fa"</span>, bc2 <span class="op">=</span> <span class="st">"bc2.fa"</span>, bc3 <span class="op">=</span> <span class="st">"bc3.fa"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    package <span class="op">=</span> <span class="st">"posDemux"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">barcode_files</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">3L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcode_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">barcode_files</span>, <span class="va">readDNAStringSet</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcodes</span> <span class="op">&lt;-</span> <span class="va">barcode_index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bc3"</span>, <span class="st">"bc2"</span>, <span class="st">"bc1"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">sequence_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>UMI <span class="op">=</span> <span class="st">"P"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">segment_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7L</span>, <span class="fl">7L</span>, <span class="fl">15L</span>, <span class="fl">7L</span>, <span class="fl">14L</span>, <span class="fl">7L</span>, <span class="cn">NA_integer_</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">streaming_summary_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="streaming_demultiplex.html">streaming_demultiplex</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    state_init <span class="op">=</span> <span class="va">callbacks</span><span class="op">$</span><span class="va">state_init</span>, loader <span class="op">=</span> <span class="va">callbacks</span><span class="op">$</span><span class="va">loader</span>,</span></span>
<span class="r-in"><span>    archiver <span class="op">=</span> <span class="va">callbacks</span><span class="op">$</span><span class="va">archiver</span>, barcodes <span class="op">=</span> <span class="va">barcodes</span>, allowed_mismatches <span class="op">=</span> <span class="fl">1L</span>,</span></span>
<span class="r-in"><span>    segments <span class="op">=</span> <span class="va">sequence_annotation</span>, segment_lengths <span class="op">=</span> <span class="va">segment_lengths</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:06 2026 =&gt; Initializing FASTQ stream and output table</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:06 2026 =&gt; Streaming FASTQ input file /home/runner/work/_temp/Library/posDemux/extdata/PETRI-seq_forward_reads.fq.gz</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:11 2026 =&gt; Processed 10000 reads, successfully demultiplexed 9117 reads so far...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:11 2026 =&gt; Processed 20000 reads, successfully demultiplexed 18259 reads so far...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:12 2026 =&gt; Processed 30000 reads, successfully demultiplexed 27362 reads so far...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:12 2026 =&gt; Processed 40000 reads, successfully demultiplexed 36487 reads so far...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:12 2026 =&gt; Processed 50000 reads, successfully demultiplexed 45629 reads so far...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:12 2026 =&gt; Processed 56895 reads, successfully demultiplexed 51906 reads so far...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Mon Feb  2 09:20:12 2026 =&gt; Done demultiplexing</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakob Peder Pettersen, Centre for new antibacterial strategies (CANS).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

