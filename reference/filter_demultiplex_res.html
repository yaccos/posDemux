<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter demultiplexed reads — filter_demultiplex_res • posDemux</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter demultiplexed reads — filter_demultiplex_res"><meta name="description" content="Filters the demultiplexed reads from combinatorial_demultiplex()
such that any read exceeding the number of allowed mismatches for any
of the barcodes is removed. The function gives diagnostic information
on the number of reads removed per barcode and the total number
of reads removed."><meta property="og:description" content="Filters the demultiplexed reads from combinatorial_demultiplex()
such that any read exceeding the number of allowed mismatches for any
of the barcodes is removed. The function gives diagnostic information
on the number of reads removed per barcode and the total number
of reads removed."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">posDemux</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/posDemux.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/streaming.html">Streaming data into the demultiplexer</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yaccos/posDemux/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter demultiplexed reads</h1>
      <small class="dont-index">Source: <a href="https://github.com/yaccos/posDemux/blob/main/R/match_filter.R" class="external-link"><code>R/match_filter.R</code></a></small>
      <div class="d-none name"><code>filter_demultiplex_res.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Filters the demultiplexed reads from <code><a href="combinatorial_demultiplex.html">combinatorial_demultiplex()</a></code>
such that any read exceeding the number of allowed mismatches for any
of the barcodes is removed. The function gives diagnostic information
on the number of reads removed per barcode and the total number
of reads removed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_demultiplex_res</span><span class="op">(</span><span class="va">demultiplex_res</span>, <span class="va">allowed_mismatches</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-demultiplex-res">demultiplex_res<a class="anchor" aria-label="anchor" href="#arg-demultiplex-res"></a></dt>
<dd><p>Unprocessed output from <code><a href="combinatorial_demultiplex.html">combinatorial_demultiplex()</a></code>.</p></dd>


<dt id="arg-allowed-mismatches">allowed_mismatches<a class="anchor" aria-label="anchor" href="#arg-allowed-mismatches"></a></dt>
<dd><p>Integer vector of length one or the same length
as the number of barcode segments; the threshold Hamming distance. All reads
having a number of mismatches above this number in any of the barcodes will
be filtered away.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with the following elements:</p><ul><li><p><code>demultiplex_res</code>: The contents of the input argument
<code>demultiplex_res</code> with the sequences filtered.</p></li>
<li><p><code>retained</code>: Logical vector with the same length as
the number of reads in the input. <code>TRUE</code> if the corresponding read
is retained.
Useful for future filtering of paired-end reads.</p></li>
<li><p><code>summary_res</code>: Result of <code><a href="create_summary_res.html">create_summary_res()</a></code> called
on the results of filtering.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The value of <code>n_removed</code> does not in general equal the sum of
<code>n_removed_per_barcode</code> since a read can have too many mismatches
with multiple barcodes.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="create_summary_res.html">create_summary_res()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings" class="external-link">Biostrings</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input_fastq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"extdata"</span>, <span class="st">"PETRI-seq_forward_reads.fq.gz"</span>, package <span class="op">=</span> <span class="st">"posDemux"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">reads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/XStringSet-io.html" class="external-link">readDNAStringSet</a></span><span class="op">(</span><span class="va">input_fastq</span>, format <span class="op">=</span> <span class="st">"fastq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcode_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"extdata/PETRI-seq_barcodes"</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>bc1 <span class="op">=</span> <span class="st">"bc1.fa"</span>, bc2 <span class="op">=</span> <span class="st">"bc2.fa"</span>, bc3 <span class="op">=</span> <span class="st">"bc3.fa"</span><span class="op">)</span>, package <span class="op">=</span> <span class="st">"posDemux"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">barcode_files</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">3L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcode_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">barcode_files</span>, <span class="va">readDNAStringSet</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcodes</span> <span class="op">&lt;-</span> <span class="va">barcode_index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bc3"</span>, <span class="st">"bc2"</span>, <span class="st">"bc1"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">sequence_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>UMI <span class="op">=</span> <span class="st">"P"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">segment_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7L</span>, <span class="fl">7L</span>, <span class="fl">15L</span>, <span class="fl">7L</span>, <span class="fl">14L</span>, <span class="fl">7L</span>, <span class="cn">NA_integer_</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">demultiplex_res</span> <span class="op">&lt;-</span> <span class="fu">posDemux</span><span class="fu">::</span><span class="fu"><a href="combinatorial_demultiplex.html">combinatorial_demultiplex</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">reads</span>, barcodes <span class="op">=</span> <span class="va">barcodes</span>, segments <span class="op">=</span> <span class="va">sequence_annotation</span>,</span></span>
<span class="r-in"><span>    segment_lengths <span class="op">=</span> <span class="va">segment_lengths</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filtered_res</span> <span class="op">&lt;-</span> <span class="fu">filter_demultiplex_res</span><span class="op">(</span><span class="va">demultiplex_res</span>, allowed_mismatches <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">freq_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="create_freq_table.html">create_freq_table</a></span><span class="op">(</span><span class="va">filtered_res</span><span class="op">$</span><span class="va">demultiplex_res</span><span class="op">$</span><span class="va">assigned_barcodes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filtered_res</span><span class="op">$</span><span class="va">summary_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of reads: 56895 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads failing to demultiplex: 4989 (8.77%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed number of unique barcode combinations:978 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of possible barcode combinations: 884736 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated number of features: 978.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed feature to barcode ratio: 0.001105 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Corrected feature to barcode ratio: 0.001106 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated number of observed barcode combinations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> corresponding to more than one feature: 0.5 (0.06%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of barcode sets: 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Barcode set: bc3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Barcode width: 7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of possible barcodes: 96 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of allowed mismatches: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads with 0 mismatches: 51923 (91.26%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads with 1 mismatches: 671 (1.18%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads above mismatch threshold: 4301 (7.56%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Barcode set: bc2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Barcode width: 7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of possible barcodes: 96 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of allowed mismatches: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads with 0 mismatches: 51918 (91.25%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads with 1 mismatches: 567 (1%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads above mismatch threshold: 4410 (7.75%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Barcode set: bc1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Barcode width: 7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of possible barcodes: 96 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of allowed mismatches: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads with 0 mismatches: 51930 (91.27%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads with 1 mismatches: 642 (1.13%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of reads above mismatch threshold: 4323 (7.6%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This also works, but is usually not necessary to call directly</span></span></span>
<span class="r-in"><span><span class="va">alternative_summary_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="create_summary_res.html">create_summary_res</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    retained <span class="op">=</span> <span class="va">filtered_res</span><span class="op">$</span><span class="va">retained</span>, barcodes <span class="op">=</span> <span class="va">barcodes</span>,</span></span>
<span class="r-in"><span>    assigned_barcodes <span class="op">=</span> <span class="va">filtered_res</span><span class="op">$</span><span class="va">demultiplex_res</span><span class="op">$</span><span class="va">assigned_barcodes</span>,</span></span>
<span class="r-in"><span>    allowed_mismatches <span class="op">=</span> <span class="fl">1L</span>, mismatches <span class="op">=</span> <span class="va">demultiplex_res</span><span class="op">$</span><span class="va">mismatches</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakob Peder Pettersen, Centre for new antibacterial strategies (CANS).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

