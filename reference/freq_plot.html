<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Diagnostic plots from demultiplexing — freq_plot • posDemux</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostic plots from demultiplexing — freq_plot"><meta name="description" content="Diagnostic plots for determining the effect of the barcode cutoff.
freq_plot() shows a histogram or distribution plot of the
number of reads for each barcode combination,
whereas knee_plot() shows the cumulative fraction of reads
ranked by the frequency of the barcode combinations in descending order."><meta property="og:description" content="Diagnostic plots for determining the effect of the barcode cutoff.
freq_plot() shows a histogram or distribution plot of the
number of reads for each barcode combination,
whereas knee_plot() shows the cumulative fraction of reads
ranked by the frequency of the barcode combinations in descending order."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">posDemux</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/posDemux.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/streaming.html">Streaming data into the demultiplexer</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yaccos/posDemux/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Diagnostic plots from demultiplexing</h1>
      <small class="dont-index">Source: <a href="https://github.com/yaccos/posDemux/blob/main/R/barcode_frequency.R" class="external-link"><code>R/barcode_frequency.R</code></a></small>
      <div class="d-none name"><code>freq_plot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Diagnostic plots for determining the effect of the barcode cutoff.
<code>freq_plot()</code> shows a histogram or distribution plot of the
number of reads for each barcode combination,
whereas <code>knee_plot()</code> shows the cumulative fraction of reads
ranked by the frequency of the barcode combinations in descending order.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">freq_plot</span><span class="op">(</span></span>
<span>  <span class="va">freq_table</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"histogram"</span>,</span>
<span>  log_scale_x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  log_scale_y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scale_by_reads <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knee_plot</span><span class="op">(</span><span class="va">freq_table</span>, cutoff <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-freq-table">freq_table<a class="anchor" aria-label="anchor" href="#arg-freq-table"></a></dt>
<dd><p>The frequency table
from <code><a href="create_freq_table.html">create_freq_table()</a></code>.</p></dd>


<dt id="arg-cutoff">cutoff<a class="anchor" aria-label="anchor" href="#arg-cutoff"></a></dt>
<dd><p>Optional scalar numeric, the
x-coordinate for drawing a vertical dashed line
in the plots in order to indicate the cutoff. Please note that this argument
is interpreted literally, meaning that in order to correctly display
the same cutoff on both type of plots,
the cutoff value has to be transformed. In order to safely convert between
the two types of cutoffs, use the functions <code><a href="bc_to_freq_cutoff.html">bc_to_freq_cutoff()</a></code>
and <code><a href="bc_to_freq_cutoff.html">freq_to_bc_cutoff()</a></code>.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>The type of frequency plot to make, either <code>'histogram'</code>
or <code>'density'</code>.</p></dd>


<dt id="arg-log-scale-x">log_scale_x<a class="anchor" aria-label="anchor" href="#arg-log-scale-x"></a></dt>
<dd><p>Logical: Should a log scale be applied
to the x-axis of the frequency plot?</p></dd>


<dt id="arg-log-scale-y">log_scale_y<a class="anchor" aria-label="anchor" href="#arg-log-scale-y"></a></dt>
<dd><p>Logical: Should a log scale be applied
to the y-axis of the frequency plot?</p></dd>


<dt id="arg-scale-by-reads">scale_by_reads<a class="anchor" aria-label="anchor" href="#arg-scale-by-reads"></a></dt>
<dd><p>Logical: Should the y-axis of the plot be scaled by the
number of reads on the x-axis?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></code> object which can be
displayed immediately or further modified.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="bc_to_freq_cutoff.html">bc_to_freq_cutoff()</a></code> <code><a href="bc_to_freq_cutoff.html">freq_to_bc_cutoff()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings" class="external-link">Biostrings</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input_fastq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"extdata"</span>, <span class="st">"PETRI-seq_forward_reads.fq.gz"</span>, package <span class="op">=</span> <span class="st">"posDemux"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">reads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/XStringSet-io.html" class="external-link">readDNAStringSet</a></span><span class="op">(</span><span class="va">input_fastq</span>, format <span class="op">=</span> <span class="st">"fastq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcode_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"extdata/PETRI-seq_barcodes"</span>, </span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>bc1 <span class="op">=</span> <span class="st">"bc1.fa"</span>, bc2 <span class="op">=</span> <span class="st">"bc2.fa"</span>, bc3 <span class="op">=</span> <span class="st">"bc3.fa"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    package <span class="op">=</span> <span class="st">"posDemux"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">barcode_files</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bc"</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">3L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcode_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">barcode_files</span>, <span class="va">readDNAStringSet</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">barcodes</span> <span class="op">&lt;-</span> <span class="va">barcode_index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bc3"</span>, <span class="st">"bc2"</span>, <span class="st">"bc1"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">sequence_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>UMI <span class="op">=</span> <span class="st">"P"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">segment_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7L</span>, <span class="fl">7L</span>, <span class="fl">15L</span>, <span class="fl">7L</span>, <span class="fl">14L</span>, <span class="fl">7L</span>, <span class="cn">NA_integer_</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">demultiplex_res</span> <span class="op">&lt;-</span> <span class="fu">posDemux</span><span class="fu">::</span><span class="fu"><a href="combinatorial_demultiplex.html">combinatorial_demultiplex</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">reads</span>, barcodes <span class="op">=</span> <span class="va">barcodes</span>, segments <span class="op">=</span> <span class="va">sequence_annotation</span>,</span></span>
<span class="r-in"><span>    segment_lengths <span class="op">=</span> <span class="va">segment_lengths</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filtered_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="filter_demultiplex_res.html">filter_demultiplex_res</a></span><span class="op">(</span><span class="va">demultiplex_res</span>, allowed_mismatches <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">freq_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="create_freq_table.html">create_freq_table</a></span><span class="op">(</span><span class="va">filtered_res</span><span class="op">$</span><span class="va">demultiplex_res</span><span class="op">$</span><span class="va">assigned_barcodes</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bc_cutoff</span> <span class="op">&lt;-</span> <span class="fl">500L</span></span></span>
<span class="r-in"><span><span class="co"># Notice the bend (knee) of the curve</span></span></span>
<span class="r-in"><span><span class="fu">knee_plot</span><span class="op">(</span><span class="va">freq_table</span>, cutoff <span class="op">=</span> <span class="va">bc_cutoff</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="freq_plot-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that we must convert the cutoff when constructing the frequency plot</span></span></span>
<span class="r-in"><span><span class="va">freq_cutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="bc_to_freq_cutoff.html">bc_to_freq_cutoff</a></span><span class="op">(</span><span class="va">freq_table</span>, <span class="va">bc_cutoff</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This is the most basic type of frequency plot which can be made,</span></span></span>
<span class="r-in"><span><span class="co"># but it is a bit hard to interpret whether a selected cutoff is sensible</span></span></span>
<span class="r-in"><span><span class="fu">freq_plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">freq_table</span>, cutoff <span class="op">=</span> <span class="va">freq_cutoff</span>, type <span class="op">=</span> <span class="st">"histogram"</span>,</span></span>
<span class="r-in"><span>    log_scale_x <span class="op">=</span> <span class="cn">FALSE</span>, log_scale_y <span class="op">=</span> <span class="cn">FALSE</span>, scale_by_reads <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value `binwidth`.</span>
<span class="r-plt img"><img src="freq_plot-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For most practical purposes, this is the most informative version</span></span></span>
<span class="r-in"><span><span class="fu">freq_plot</span><span class="op">(</span><span class="va">freq_table</span>, cutoff <span class="op">=</span> <span class="va">freq_cutoff</span>, type <span class="op">=</span> <span class="st">"density"</span>,</span></span>
<span class="r-in"><span>    log_scale_x <span class="op">=</span> <span class="cn">TRUE</span>, log_scale_y <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    scale_by_reads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="freq_plot-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakob Peder Pettersen, Centre for new antibacterial strategies (CANS).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

